#!/usr/bin/env ruby
# bin/compile <build-dir> <cache-dir> <env-dir>

require 'json'

build_dir   = ARGV[0]
cache_dir   = ARGV[1]
env_dir     = ARGV[2]
static_json = "#{build_dir}/static.json"

if File.directory?(env_dir) && File.exist?(static_json)
  json = JSON.parse(File.read(static_json))
  if json["proxies"]
    File.open("#{env_dir}/API_URL", "w") do |file|
      value = json["proxies"].values.first["origin"]
      puts "-----> Writing ENV VAR API_URL: #{value}"
      file.print value
    end
    cmd = `ls -l #{env_dir}`
    puts "-----> ENV DIR:\n#{cmd}"
  end
end
